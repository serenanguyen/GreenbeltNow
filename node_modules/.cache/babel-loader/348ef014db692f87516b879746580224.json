{"ast":null,"code":"// Copyright (c) 2012, Mark Cavage. All rights reserved.\n// Copyright 2015 Joyent, Inc.\nvar assert = require('assert');\n\nvar Stream = require('stream').Stream;\n\nvar util = require('util'); ///--- Globals\n\n/* JSSTYLED */\n\n\nvar UUID_REGEXP = /^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/; ///--- Internal\n\nfunction _capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction _toss(name, expected, oper, arg, actual) {\n  throw new assert.AssertionError({\n    message: util.format('%s (%s) is required', name, expected),\n    actual: actual === undefined ? typeof arg : actual(arg),\n    expected: expected,\n    operator: oper || '===',\n    stackStartFunction: _toss.caller\n  });\n}\n\nfunction _getClass(arg) {\n  return Object.prototype.toString.call(arg).slice(8, -1);\n}\n\nfunction noop() {} // Why even bother with asserts?\n///--- Exports\n\n\nvar types = {\n  bool: {\n    check: function (arg) {\n      return typeof arg === 'boolean';\n    }\n  },\n  func: {\n    check: function (arg) {\n      return typeof arg === 'function';\n    }\n  },\n  string: {\n    check: function (arg) {\n      return typeof arg === 'string';\n    }\n  },\n  object: {\n    check: function (arg) {\n      return typeof arg === 'object' && arg !== null;\n    }\n  },\n  number: {\n    check: function (arg) {\n      return typeof arg === 'number' && !isNaN(arg);\n    }\n  },\n  finite: {\n    check: function (arg) {\n      return typeof arg === 'number' && !isNaN(arg) && isFinite(arg);\n    }\n  },\n  buffer: {\n    check: function (arg) {\n      return Buffer.isBuffer(arg);\n    },\n    operator: 'Buffer.isBuffer'\n  },\n  array: {\n    check: function (arg) {\n      return Array.isArray(arg);\n    },\n    operator: 'Array.isArray'\n  },\n  stream: {\n    check: function (arg) {\n      return arg instanceof Stream;\n    },\n    operator: 'instanceof',\n    actual: _getClass\n  },\n  date: {\n    check: function (arg) {\n      return arg instanceof Date;\n    },\n    operator: 'instanceof',\n    actual: _getClass\n  },\n  regexp: {\n    check: function (arg) {\n      return arg instanceof RegExp;\n    },\n    operator: 'instanceof',\n    actual: _getClass\n  },\n  uuid: {\n    check: function (arg) {\n      return typeof arg === 'string' && UUID_REGEXP.test(arg);\n    },\n    operator: 'isUUID'\n  }\n};\n\nfunction _setExports(ndebug) {\n  var keys = Object.keys(types);\n  var out;\n  /* re-export standard assert */\n\n  if (process.env.NODE_NDEBUG) {\n    out = noop;\n  } else {\n    out = function (arg, msg) {\n      if (!arg) {\n        _toss(msg, 'true', arg);\n      }\n    };\n  }\n  /* standard checks */\n\n\n  keys.forEach(function (k) {\n    if (ndebug) {\n      out[k] = noop;\n      return;\n    }\n\n    var type = types[k];\n\n    out[k] = function (arg, msg) {\n      if (!type.check(arg)) {\n        _toss(msg, k, type.operator, arg, type.actual);\n      }\n    };\n  });\n  /* optional checks */\n\n  keys.forEach(function (k) {\n    var name = 'optional' + _capitalize(k);\n\n    if (ndebug) {\n      out[name] = noop;\n      return;\n    }\n\n    var type = types[k];\n\n    out[name] = function (arg, msg) {\n      if (arg === undefined || arg === null) {\n        return;\n      }\n\n      if (!type.check(arg)) {\n        _toss(msg, k, type.operator, arg, type.actual);\n      }\n    };\n  });\n  /* arrayOf checks */\n\n  keys.forEach(function (k) {\n    var name = 'arrayOf' + _capitalize(k);\n\n    if (ndebug) {\n      out[name] = noop;\n      return;\n    }\n\n    var type = types[k];\n    var expected = '[' + k + ']';\n\n    out[name] = function (arg, msg) {\n      if (!Array.isArray(arg)) {\n        _toss(msg, expected, type.operator, arg, type.actual);\n      }\n\n      var i;\n\n      for (i = 0; i < arg.length; i++) {\n        if (!type.check(arg[i])) {\n          _toss(msg, expected, type.operator, arg, type.actual);\n        }\n      }\n    };\n  });\n  /* optionalArrayOf checks */\n\n  keys.forEach(function (k) {\n    var name = 'optionalArrayOf' + _capitalize(k);\n\n    if (ndebug) {\n      out[name] = noop;\n      return;\n    }\n\n    var type = types[k];\n    var expected = '[' + k + ']';\n\n    out[name] = function (arg, msg) {\n      if (arg === undefined || arg === null) {\n        return;\n      }\n\n      if (!Array.isArray(arg)) {\n        _toss(msg, expected, type.operator, arg, type.actual);\n      }\n\n      var i;\n\n      for (i = 0; i < arg.length; i++) {\n        if (!type.check(arg[i])) {\n          _toss(msg, expected, type.operator, arg, type.actual);\n        }\n      }\n    };\n  });\n  /* re-export built-in assertions */\n\n  Object.keys(assert).forEach(function (k) {\n    if (k === 'AssertionError') {\n      out[k] = assert[k];\n      return;\n    }\n\n    if (ndebug) {\n      out[k] = noop;\n      return;\n    }\n\n    out[k] = assert[k];\n  });\n  /* export ourselves (for unit tests _only_) */\n\n  out._setExports = _setExports;\n  return out;\n}\n\nmodule.exports = _setExports(process.env.NODE_NDEBUG);","map":null,"metadata":{},"sourceType":"script"}